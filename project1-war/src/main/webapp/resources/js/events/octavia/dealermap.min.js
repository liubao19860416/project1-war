(function(e,i){var k=i.imitatescroll({id:"#DealerList"}),g=e("#DealerList ul.dealer-list-content-list"),h,d,f=base+"/octaviaActivity/finddistributor_{cityId}_{areaId}_{brandId}_{classId}.htm",a;e(window).bind("filter.change",function(l){clearTimeout(d);d=setTimeout(j,100)});e(window).bind("dealer.click",function(m){a.showDealer(m.index);g.find(".selected").removeClass("selected");var l=g.find("li:eq("+m.index+")").addClass("selected");k.scrollTo(l.position().top)});e(window).bind("dealer.hide",function(l){a.hideDealer(l.index);g.find(".selected").removeClass("selected")});e(window).trigger("filter.change");e("#cityId").change(function(){var l=e(this);b(l.val(),l[0].options[this.selectedIndex].innerHTML)});e("#areaSel select").change(function(){e(window).trigger("filter.change")});new i.uiform("#areaSel .sel-city",{selectClass:"form-select sel-city"});new i.uiform("#areaSel .sel-area",{selectClass:"form-select sel-area"});i.seriesSelect(e("#areaSel"),{selects:["sel-city","sel-area"],url:base+"/tryDrive/ajax/ajaxDistrictList.htm"});function j(){var l=f.replace(/{cityId}/,e("#cityId").val()).replace(/{areaId}/,e("#areaId").val()||0).replace(/{brandId}/,e("#brandId").val()||0).replace(/{classId}/,e("#serialId").val()||0);h&&h.abort();h=e.getJSON(l,function(m){c(m,g)})}function c(q,l){a&&a.clearDealers();if(q.length==1&&!q[0].storeId){l.html('<li class="null"><i class="icon icon-alert-gray-m"></i><div>'+q[0].name||"</div></li>");k.reset();return}l.empty();var s=e(document.createDocumentFragment()),n=360,m=90,p=3,o=0;e(q).each(function(w,x){x.index=w;x.longitude=parseFloat(x.longitude);x.latitude=parseFloat(x.latitude);var v="",u=x.name;if(u.length>30){u=u.substring(0,29)+"..."}v='<li id="dealer_'+x.storeId+'"><a href="javascript:void(0)" '+(x.name.length>30?'title="'+x.name+'"':"")+">"+u+"</a></li>";e(v).addClass(w%2==0?"odd":"even").appendTo(s).on("click",function(y){e(window).trigger({type:"dealer.click",index:x.index})});n=x.longitude<n?x.longitude:n;p=x.longitude>p?x.longitude:p;m=x.latitude<m?x.latitude:m;o=x.latitude>o?x.latitude:o});if(typeof(BMap)!=="undefined"){if(!a){a=new i.map("DealerMap",[new BMap.Point(n,m),new BMap.Point(p,o)])}else{a.setViewport([new BMap.Point(n,m),new BMap.Point(p,o)])}a.bindDealers(q,function(y){var w="",v=y.name,u=y.promotionTitle||"",x=e("#serialId").val()||-1;if(v.length>30){v=v.substring(0,29)+"..."}if(u.length>14){u=u.substring(0,13)+"..."}w='<h5><a href="'+_DealerUrl_.replace("{id}",y.storeId)+'" target="_blank" '+(y.name.length>30?'title="'+y.name+'"':"")+">"+v+"</a></h5><p>经营品牌："+y.brandName+'</p><p class="c-dealer-map-info-address">地址：'+y.address+'</p><p><span class="icon iphoneicon"></span><span class="telcolor">'+y.tel+'</span><input class="btn btn-dealercall" data-dealercall="'+y.storeId+'" type="button" value="免费咨询"></p>'+(u==""?"":'<p class="c-dealer-map-info-event"><strong>促销</strong><a href="'+_EventUrl_.replace(/\{[^\}]*\}/g,function(z){if(z=="{id}"){return y.storeId}else{if(z=="{eid}"){return y.promotionId}}})+'" target="_blank" '+(y.promotionTitle.length>14?'title="'+y.promotionTitle+'"':"")+">"+u+"</a></p>")+'<p class="c-dealer-map-info-btnset"><a href="'+_TrailDive_.replace(/\{[^\}]*\}/g,function(z){if(z=="{id}"){return y.storeId}else{if(z=="{brandId}"){return y.brandId}else{if(z=="{serialId}"){return x}}}})+'" target="_blank" class="btn btn126-34 btn-blue btn-med-drive">预约试驾</a></p>';return w})}s.appendTo(l);k.reset();if(/[\?,&]dealerId=[^&]+/.test(location.search)){var t=location.search.replace(/.*dealerId=([^&]*).*/,"$1");var r=e("#dealer_"+t);if(r.length>0){r.trigger("click")}}else{setTimeout(function(){l.find("li:first").trigger("click")},200)}}function b(p,n,o){var m=new Date();if(!o){o=document.cookie.match(/(^| )city\.domain=([^;]*)(;|$)/);o&&(o=o[2])}m.setTime(m.getTime()+12*30*24*60*60*1000);var l=o&&o!="null"?(";domain="+o):"";document.cookie="city.id="+encodeURIComponent(p)+";expires="+m.toGMTString()+";path=/"+l;document.cookie="city.name="+encodeURIComponent(n)+";expires="+m.toGMTString()+";path=/"+l;document.cookie="city.domain="+encodeURIComponent(o)+";expires="+m.toGMTString()+";path=/"+l;document.cookie="city.test="+encodeURIComponent(o)+";expires="+m.toGMTString()+";path=/"}})(jQuery,window.ECar||(window.ECar={}));