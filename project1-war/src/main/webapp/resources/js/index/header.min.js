function showDrop(b,d,c){var a=null;b.mouseover(function(){clearTimeout(a);$(this).addClass(d);c.show()}).mouseout(function(){a=setTimeout(function(){c.slideUp(200,function(){b.removeClass(d)})},500)})}(function(b){b(function(){b.ajax({url:(typeof isOrder!="undefined"&&isOrder?orderBase:base)+"/common/head.htm",dataType:"json",cache:false,success:function(h){if(h){b("#box01").hide().siblings("#box02").show();b("#box02").children().eq(0).text(h.greetings+"，");b("#userCenter").find(".current").text(h.realName);if(h.unreadMsgCount==0){b(".no-readline").hide().next(".gotomsg").hide()}else{if(h.unreadMsgCount>0){b(".no-readline").show().next(".gotomsg").show()}}}else{b("#box01").show().siblings("#box02").hide()}}});b(".login-bind").on("click",function(){var h=window.location.href;window.location.href=mainBase+"/account/login.htm?backUrl="+encodeURIComponent(h)});b(".register-bind").on("click",function(){var h=window.location.href;window.location.href=mainBase+"/account/m_register.htm?backUrl="+encodeURIComponent(h)});function e(){var h=b("#currentCity"),i=b("div.city").find(".city-name");i.each(function(){if(b(this).attr("cityid")==h.attr("cityid")){b(this).addClass("sel")}})}function f(){var h=b("#currentCity"),j=b("#currentCity").parent("h3"),i=h.val(),k=b("div.city");k.on("click","a",function(){var m=b(this).attr("cityid"),l=b(this).attr("name");c(m,l);h.attr({cityid:m,name:l}).text(l);k.hide();d();window.location.reload(true)});showDrop(j,"on",k)}function c(l,j,k){var i=new Date();if(!k){k=document.cookie.match(/(^| )city\.domain=([^;]*)(;|$)/);k&&(k=k[2])}i.setTime(i.getTime()+12*30*24*60*60*1000);var h=k&&k!="null"?(";domain="+k):"";document.cookie="city.id="+encodeURIComponent(l)+";expires="+i.toGMTString()+";path=/"+h;document.cookie="city.name="+encodeURIComponent(j)+";expires="+i.toGMTString()+";path=/"+h;document.cookie="city_id="+encodeURIComponent(l)+";expires="+i.toGMTString()+";path=/"+h;document.cookie="city_name="+encodeURIComponent(j)+";expires="+i.toGMTString()+";path=/"+h;document.cookie="city.domain="+encodeURIComponent(k)+";expires="+i.toGMTString()+";path=/"+h}function d(){var k={},t=document.cookie,n="",r="上海",m=b("#currentCity");if(t===""){c("310100","上海");m.attr({cityid:"310100",name:"上海"}).text("上海")}else{var q=t.split("; ");for(var l=0;l<q.length;l++){var k=q[l];var j=k.indexOf("=");var h=k.substring(0,j);var s=k.substring(j+1);try{s=decodeURIComponent(s)}catch(o){continue}k[h]=s;if(h=="city.id"||h=="city_id"){n=s}if(h=="city.name"||h=="city_name"){r=s}}if(n==""||r==""){g()}m.attr({cityid:n,name:r}).text(r)}}function g(){b.getJSON("http://api.map.baidu.com/location/ip?ak=F454f8a5efe5e577997931cc01de3974&ip=&callback=?",function(i){var h="";if(i){if(i.status==0){h=i.address.split("|")[2]}}b.getJSON(base+"/common/cityid.htm?cityName="+h,function(j){if(j){c(j.cityId,j.cityName,j.domain)}})})}if(b(".city-t").length>0){d();f();setTimeout(function(){e()},500);a()}showDrop(b("#userCenter"),"usercenter-on",b("#useGroup"))});function a(){b.getJSON((typeof isOrder!="undefined"&&isOrder?orderBase:base)+"/common/cityList.htm",function(d){var c=b(document.createDocumentFragment());b.each(d,function(f,g){var e=b('<a href="javascript:void(0);" cityid="'+g.code+'" name="'+g.name+'" class="city-name"><span>'+g.name+"</span></a>");e.appendTo(c)});c.appendTo(b("#citychage"))})}})(jQuery);