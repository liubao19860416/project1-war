(function(d,a){a.validate=function(){var e={};e.form=d(arguments[0]);if(arguments.length==2){e=d.extend(this.defaults,e,arguments[1])}this.init(e)};a.validate.prototype={defaults:{submit:function(){this.form[0].submit()},fail:d.noop},init:function(f){var f=this.options=f,h=this.form=f.form,g=this,e=this.items=[];d("input,select,textarea",h).each(function(){e.push(new c(this))});h.bind("submit",(function(i){return function(j){j.preventDefault();j.stopImmediatePropagation();g.valid().done(function(){if(i.options.submit.call(i,i.form)!==false){i.form[0].submit()}}).fail(function(){var k=i.form.find(".m-err:visible:first");if(k.length>0&&(k.offset().top+k.height()<d(window).scrollTop()||k.offset().top>d(window).scrollTop()+d(window).height())){d(window).scrollTop(k.offset().top-10)}i.options.fail.call(i,i.form)})}})(this))},valid:function(){var e=[];d.each(this.items,function(){e=e.concat(this.valid())});return d.when.apply(d,e)}};a.validate.ValidateItem=c;function c(g){var i=this.rules=[],f=this,g=this.item=d(g),e=this.msgContainer=d("[data-msg-for="+g.attr("id")+"]");if(e.text().length>0){e.parent().show()}if(g.data("required")){i.push(new b({name:"required",element:g,errorMsg:g.data("msgRequired")}))}if(g.data("lengthMin")){i.push(new b({name:"lengthMin",element:g,errorMsg:g.data("msgLengthMin"),lengthMin:parseInt(g.data("lengthMin"))||0}))}if(g.data("regexp")){i.push(new b({name:"regexp",element:g,errorMsg:g.data("msgRegexp"),regexp:g.data("regexp")}))}if(g.data("remote")){i.push(new b({name:"remote",element:g,errorMsg:g.data("msgRemote"),url:g.data("remote"),params:g.data("remoteParams")}))}var h="validate ";if(g.is("select,input:radio,input:checkbox,input:hidden")){h+=" change"}else{if(g.is("input:text,input:password")){h+="blur"}}g.bind(h,function(){setTimeout(function(){f.valid()},100)})}c.prototype={valid:function(){var e=[],f=this;this.msgContainer.empty().parent().hide();d.each(this.rules,function(){var g=this.valid(),h=this;e.push(g);d.when(g).fail(function(){f.showError(h.errorMsg);g=false});return g});return e},showError:function(e){this.msgContainer.text(e).parent().show()}};function b(e){this.init(e)}b.prototype={init:function(f){for(var e in f){this[e]=f[e]}},valid:function(){return this.method[this.name].call(this)},method:{required:function(){var g=d(this.element),f=d.Deferred();if(g.is(":text,:password,input[type=hidden]")){d.trim(g.val()).length>0?f.resolve():f.reject()}else{if(g[0].nodeName.toLowerCase()==="select"){var e=g.val();e&&e!=="0"?f.resolve():f.reject()}else{if(g.is(":radio,:checkbox")){d("input[name="+g.attr("name")+"]:checked").length>0?f.resolve():f.reject()}else{f.resolve()}}}return f},regexp:function(){var g=this.element,e=this.regexp,f=d.Deferred();(new RegExp(e)).test(g.val())?f.resolve():f.reject();return f},lengthMin:function(){var g=this.element,e=this.lengthMin,f=d.Deferred();this.lengthMin<=d.trim(g.val()).length?f.resolve():f.reject();return f},remote:function(){var j=d(this.element),i=d.Deferred(),e=this.url,h=(function(){var l={};l[j.attr("name")]=j.val();d(this.params).each(function(){l[this.name]=d(this).val()});return l})(),g=this.xhr,k=this.timer,f=this;if(k){clearTimeout(k);delete this.timer}if(g){g.abort()}this.timer=setTimeout(function(){f.xhr=d.getJSON(e,h,function(l){if(l){i.resolve()}else{i.reject()}})},300);return i}}}})(jQuery,window.ECar||(window.ECar={}));