(function(d,b,c,g){if(!c.BMap){c.BMap=function(){};BMap.loaded=false;c.BMap.Map=c.BMap.Point=d.noop;c.BMap.Map.setViewport=d.noop}b.map=function(i,e){var h;if(BMap.loaded!==false){h=this.instance=new BMap.Map(i,{enableMapClick:false})}else{h=this.instance=null;return}if(d.isArray(e)){this.setViewport(e)}else{this.centerAndZoom(e,11)}h.addControl(new BMap.NavigationControl());h.enableScrollWheelZoom(true);this.overlays=[];this.currentOverlay=null};b.map.prototype={bindDealers:function(i,e){if(!this.instance){return}var j=this.instance,h=this;this.overlays=[];j.clearOverlays();d(i).each(function(m,l){var k=new a(l,e||d.noop);h.overlays.push(k);j.addOverlay(k)})},clearDealers:function(){if(!this.instance){return}this.instance.clearOverlays()},centerAndZoom:function(e,i,h){if(!this.instance){return}if(arguments.length==3){this.instance.centerAndZoom(new BMap.Point(e,i),h)}else{if(arguments.length==2){this.instance.centerAndZoom(arguments[0],arguments[1])}}},setViewport:function(e){if(!this.instance){return}e[0].lng-=0.001;e[0].lat-=0.001;e[1].lng+=0.001;e[1].lat+=0.001;this.instance.setViewport(e)},showDealer:function(e){if(!this.instance){return}if(this.currentOverlay){this.currentOverlay.hideDetail()}this.currentOverlay=this.overlays[e];this.overlays[e].showDetail()},selectDealer:function(e,h){if(!this.instance){return}if(this.currentOverlay){this.currentOverlay.selected(false)}this.currentOverlay=this.overlays[e];this.overlays[e].selected(h)},hideDealer:function(e){if(!this.instance){return}this.currentOverlay=null}};function a(h,e){this.data=h;this.map=null;this.isCurrent=false;this.infoWin=null;this.div=null;this.showDealerCallback=e}try{a.prototype=new BMap.Overlay();a.prototype.initialize=function(h){var e=this;this.map=h;var i=d("<div>").addClass("c-dealer-mapitem");d("<div>").addClass("c-dealer-mapitem-arrow").appendTo(i).hover(function(){d(this).addClass("c-dealer-mapitem-arrow-hover")},function(){d(this).removeClass("c-dealer-mapitem-arrow-hover")}).click(function(){d(c).trigger({type:"dealer.click",index:e.data.index,item:e.data})});h.getPanes().labelPane.appendChild(i[0]);this.div=i[0];return i[0]};a.prototype.draw=function(){var h=this.map;var e=h.pointToOverlayPixel(new BMap.Point(this.data.longitude,this.data.latitude));d(this.div).css({left:e.x,top:e.y})};a.prototype.showDetail=function(){if(!this.infoWin){var i=this;this.infoWin=d("<div>").addClass("c-dealer-map-infowin").appendTo(this.div);this.infoContent=d("<div>").addClass("c-dealer-map-infowin-content").appendTo(this.infoWin);var j=this.data,h=this.showDealerCallback.call(this,j);d(h).appendTo(this.infoContent);d("<div>").addClass("c-dealer-map-infowin-narrow").appendTo(this.infoWin);d("<div>").addClass("c-dealer-map-infowin-close").appendTo(this.infoWin).click(function(){d(c).trigger({type:"dealer.hide",index:i.data.index});i.hideDetail()})}var e=this.map.pointToPixel(new BMap.Point(this.data.longitude,this.data.latitude));e.x+=100;e.y-=80;this.map.panTo(this.map.pixelToPoint(e));this.infoWin.show();d(this.div).addClass("c-dealer-mapitem-current");this.isCurrent=true};a.prototype.selected=function(e){(e?d.fn.addClass:d.fn.removeClass).call(d(this.div),"c-dealer-mapitem-current")},a.prototype.hideDetail=function(){this.infoWin.hide();d(this.div).removeClass("c-dealer-mapitem-current");this.isCurrent=false}}catch(f){}})(jQuery,window.ECar||(window.ECar={}),window);