(function(a){window.chageCodeImage=function(b){document.getElementById(b).src=base+"/account/validateCode.htm?d="+new Date().getTime()};a(function(){a('#register-infor [validate="password"]').keyup(function(o){var p=window.event||o;pwdCheck.init(p,a(this).val(),a(".register-infor .pwdline"))}).trigger("keyup");a(".remember .check").toggle(function(){a(this).removeClass("ticks");a(".remember .checkbox").attr("checked",false);a(".remember").find("span.m-err").show()},function(){a(this).addClass("ticks");a(".remember .checkbox").attr("checked",true);a(".remember").find("span.m-err").hide()});a('[for="ifRemenberMe"]').click(function(){a(".remember .check").click()});var i=a("input[name='userNameType']");a("input.excluded").off();var h=function(){var A=a(".account"),B=A.closest("dd").children(".tip"),D=A.closest("dd").children(".m-err"),r=D.find(".errTxt"),q=A.closest("dd").children(".icon-checked-m"),E={mobile:"手机号",email:"邮箱",username:"用户名"},s=null,p=false;A.on("focus",function(){B.show();D.hide();q.hide();A.removeClass("m-member-orange")});var z={basicRule:/^[a-zA-Z0-9@]*$/,mobile:/^1[3,4,5,7,8]\d{9}$/,onlyNum:/^[0-9]*$/,email:/^[0-9a-zA-Z][_.0-9A-Za-z-]{0,31}@([0-9A-Za-z][0-9A-Za-z-]{0,30}\.){1,4}[A-Za-z]{2,4}$/};A.on("blur",y);function y(){B.hide();var F;var G=A.val();if(G.match(z.mobile)){F="mobile"}else{if(z.email.test(G)){F="email"}else{if(G.length===0){x("车享账号一定要填写喔")}else{if(!(z.basicRule.test(G))){x("用户名只可以用数字和字母喔")}else{if(G.length<6||G.length>20){x("账号需要6-20位长哟")}else{if(z.onlyNum.test(G)&&!z.mobile.test(G)){x("用户名不能是纯数字，请确认输入的是手机号或者重新输入")}else{if(G.indexOf("@")!==-1&&!z.email.test(G)){x("您输入的邮箱地址有误喔，检查一下吧")}else{F="username"}}}}}}}s=F?E[F]:null;o(F);t(F);u(F);return v(F,G)}function C(F){if(F){q.show()}}function w(){return p}function o(F){p=!!F}function u(F){switch(F){case"mobile":i.val(1);break;case"email":i.val(2);break;case"username":i.val(3);break}}function t(F){if(F=="mobile"){b.hide();f.show()}else{f.hide();b.show()}}function x(F){r.html(F);D.eq(0).show().siblings(".m-err").hide();A.addClass("m-member-orange")}function v(G,F){if(G){A.removeClass("m-member-orange");return a.ajax({url:base+"/account/userIsExist.htm",dataType:"JSON",data:{userName:F,userNameType:i.val()},type:"POST",success:function(J){var I=J.isExist;mobileCapcha.enable();if(I==="0"){q.show();o(true)}else{if(I==="1"){var H=a("#backUrl").val();x("您输入的"+s+'已被注册过啦，<a href="'+base+"/account/login.htm?backUrl="+H+'">点此直接登录</a>吧!');o(false);if(s==="手机号"){mobileCapcha.disable()}}else{if(I==="2"){var H=a("#backUrl").val();var K=base+"/account/presendEmailagain.htm?email="+F+"&backUrl="+H;x('您的邮箱处于未激活状态哟，<a href="'+K+'">点此重发验证邮件</a>吧!');o(true)}}}},error:function(){}})}}return{$input:A,state:w,validate:y}}();var m=(function(){var u=a("input[validate='password']"),s=u.siblings(".tip"),x=u.siblings(".m-err"),o=x.find(".errTxt"),q=u.siblings(".icon-checked-m"),p=false;u.on("focus",function(){s.text("您需要输入6-20位字符哟，使用字母、数字或符号组合更安全").show();x.hide();q.hide();u.removeClass("m-member-orange")});u.on("blur",v);function v(){s.hide();var y=r();if(!y.ok){o.text(y.message);x.show();u.addClass("m-member-orange");p=false}else{if(y.message){s.text(y.message).show()}else{q.show()}p=true}if(g.$input.val()){g.$input.trigger("blur")}}var w={allNumber:/^[0-9]{6,20}$/};function t(){return p}function r(){var y={ok:true,message:null};var z=u.val();if(z.length===0){y.ok=false;y.message="不要心急哟，密码还空着呐"}else{if(z.length<6||z.length>20){y.ok=false;y.message="密码需要6-20位长哟"}else{if(w.allNumber.test(z)){y.ok=true;y.message="密码还可以再复杂一些喔，如字母+数字的组合，这样账号安全性会大大提升"}else{y.ok=true;y.message=null}}}return y}return{$input:u,state:t,validate:v}})();var g=(function(){var u=a("input[validate='repassword']"),s=u.siblings(".tip"),w=u.siblings(".m-err"),o=w.find(".errTxt"),q=u.siblings(".icon-checked-m"),p=false;function t(){return p}u.on("focus",function(){s.text("再次核对您的密码喔").show();w.hide();q.hide();u.removeClass("m-member-orange")});u.on("blur",v);function v(){s.hide();var x=r();if(!x.ok){o.text(x.message);w.show();u.addClass("m-member-orange");p=false;q.hide()}else{w.hide();p=true;q.show();u.removeClass("m-member-orange")}}function r(){var x={ok:true,message:null};var y=u.val();if(y.length===0){x.ok=false;x.message="不要心急哟，确认密码还空着呐"}else{if(a("input[validate='password']").val()!=y){x.ok=false;x.message="您两次输入的密码不一致喔"}else{x.ok=true;x.message=null}}return x}return{$input:u,state:t,validate:v}})();var d="<span class='timeLeft'>120</span>秒后重新发送";var f=a(".sms");mobileCapcha=function(){var r=f,o=r.find(".btn"),s=r.find(".m-notice.tip"),q=false,w=true;o.on("click",function(){if(q){return}h.validate().done(function(){if(h.state()&&v()){a.ajax({url:base+"/account/toGetPhoneCodenew.htm?d="+new Date().getMilliseconds(),type:"POST",data:{Num:h.$input.val(),temStyle:a("#mobTemStyle").val(),typeId:a("#mobileTypeId").val()},dataType:"JSON",success:function(x){if(x===0){o.html(d);t();s.show();p(o.find(".timeLeft"),120*1000,function(){o.html("获取验证码").removeClass("btn-gray btn-disable");u();q=false;s.hide()});q=true}},error:function(){l.showWrongMsg("请求发送验证码失败，请重新再试！")}})}})});function t(){o.addClass("btn-gray btn-disable");w=false}function u(){if(q){return}o.removeClass("btn-gray btn-disable");w=true}function v(){return w}function p(z,B,x){var y=B,A=B;var C=setInterval(function(){A-=1000;z.text(parseInt(A/1000))},1000);setTimeout(function(){clearInterval(C);x()},y)}return{dom:r,enable:u,disable:t}}();var b=a(".yzm");var l=function(){var t=a("#codeId"),p=t.siblings("#emailErr"),q=p.find(".errTxt"),r=false;function o(){return r}t.on("blur",s);function s(){if(a.trim(t.val()).length===0){q.text("哎呀，验证码好像不正确");p.show();t.addClass("m-member-orange");r=false}else{r=true}}t.on("focus",function(){p.hide().siblings(".m-err").hide();t.siblings("#codeMsg").hide();t.removeClass("m-member-orange")});return{$input:t,state:o,validate:s,showWrongMsg:function(u){q.text(u);p.show();t.addClass("m-member-orange")}}}();var j=function(){var r=a("#ifRemenberMe"),p=false;function o(){return p}function q(){if(!r.attr("checked")){p=false}else{p=true}}r.blur(q);return{$input:r,state:o,validate:q}}();var k=a(".registerbut .btn"),n=a("#register-infor");var c=[h,m,g,l,j];k.on("click",function(){validation=[];a.each(c,function(){validation.push(this.validate())});a.when.apply(null,validation).done(function(){var o=true;a.each(c,function(){if(this.state()===false){o=false;return false}});if(o){n.submit()}})});var e=i.val();if(e=="1"){a(".yzm").hide();a(".sms").show()}ECar.placeholder(a(".account"))})})(jQuery);